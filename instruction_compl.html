<!DOCTYPE html>
<html lang="en">
<head>
    
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Complex Case Discharge Delay ‚Äî Albuquerque Hospitals Pilot</title>
<style>
  :root{
    --ink:#111827;      /* text */
    --sub:#4b5563;      /* secondary text */
    --bg:#f7f8fa;       /* background */
    --card:#ffffff;     /* surfaces */
    --line:#e5e7eb;     /* borders */
    --brand:#0ea5e9;    /* accent */
    --brand-2:#22c55e;  /* success */
    --warn:#f59e0b;     /* warning */
    --danger:#ef4444;   /* danger */
    --muted:#9ca3af;    
    --ring:rgba(14,165,233,.35);
  }
  [data-theme="dark"]{
    --ink:#e5e7eb; --sub:#a1a1aa; --bg:#0b0f14; --card:#0f1720; --line:#1f2a37;
    --brand:#38bdf8; --brand-2:#34d399; --warn:#fbbf24; --danger:#f87171; --muted:#6b7280; --ring:rgba(56,189,248,.35);
  }
  html,body{height:100%}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,"Helvetica Neue";background:var(--bg);color:var(--ink);}
  a{color:var(--brand);text-decoration:none}
  a:hover{text-decoration:underline}
  .container{max-width:100%;margin:0 auto;padding:24px}
  header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,0));backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .topbar{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:12px 24px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 180deg at 50% 50%, var(--brand), var(--brand-2));box-shadow:0 4px 18px rgba(0,0,0,.12)}
  .title{font-weight:700;letter-spacing:.2px}
  .muted{color:var(--sub)}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:var(--card);color:var(--ink);cursor:pointer;transition:.2s;}
  .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.08)}
  .btn.primary{background:linear-gradient(180deg, var(--brand), #0ea5e9);border:none;color:white}
  .btn.ghost{background:transparent}
  .grid{display:grid;gap:16px}
  @media(min-width:900px){
    .grid.cols-3{grid-template-columns:1.1fr .9fr}
  }
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 6px 24px rgba(0,0,0,.04)}
  .hero{display:grid;gap:16px;align-items:center;padding:20px 24px}
  @media(min-width:900px){.hero{grid-template-columns:1.2fr .8fr}}
  .big{font-size:clamp(22px, 2.6vw, 34px);font-weight:800;line-height:1.15;margin:0}
  .sub{margin:6px 0 0 0;color:var(--sub)}
  .pill{display:inline-flex;align-items:center;gap:8px;border:1px dashed var(--line);padding:8px 12px;border-radius:999px;color:var(--sub);background:rgba(0,0,0,.02)}
  .progress{height:12px;border-radius:999px;background:var(--line);overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg, var(--brand), var(--brand-2));transition:width .3s ease}
  details{border:1px solid var(--line);border-radius:14px;padding:14px;background:var(--card)}
  details+details{margin-top:10px}
  summary{cursor:pointer;font-weight:600;display:flex;align-items:center;gap:10px}
  .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);color:var(--sub)}
  .danger{color:var(--danger)}
  .warn{color:var(--warn)}
  .success{color:var(--brand-2)}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .checklist li{list-style:none;display:flex;align-items:flex-start;gap:10px;margin:10px 0}
  .checklist input{width:18px;height:18px}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:rgba(0,0,0,.06);border:1px solid var(--line);border-radius:6px;padding:2px 6px}
  .code{background:rgba(0,0,0,.06);border:1px solid var(--line);padding:10px;border-radius:10px;font-family:ui-monospace,Consolas,monospace;overflow:auto}
  .inline-help{font-size:13px;color:var(--sub)}
  .copy{margin-left:auto}
  .search{width:100%;padding:10px 12px;border:1px solid var(--line);background:var(--card);border-radius:12px}
  .glossary dt{font-weight:700;margin-top:10px}
  .glossary dd{margin:4px 0 10px 0;color:var(--sub)}
  .footer{padding:24px;color:var(--sub);text-align:center}
  .toast{position:fixed;bottom:18px;right:18px;padding:12px 14px;border-radius:12px;background:var(--card);border:1px solid var(--line);box-shadow:0 8px 28px rgba(0,0,0,.15);opacity:0;transform:translateY(10px);transition:.2s}
  .toast.show{opacity:1;transform:translateY(0)}
  .sbs{display:grid;gap:12px}
  @media(min-width:900px){.sbs{grid-template-columns:1fr 1fr}}
  .print-note{font-size:12px;color:var(--muted)}
  @media print{
    header,.btn,.search,.toast{display:none !important}
    body{background:white}
    .card{box-shadow:none}
  }
  /* ==== Colorful theme + animations ==== */
  :root{
    --ink:#0b132b; --sub:#334155; --bg:#fdf7ff; --card:#ffffff; --line:#e9d5ff;
    --brand:#a855f7; --brand-2:#06b6d4; --warn:#f59e0b; --danger:#ef4444; --muted:#6b7280; --ring:rgba(168,85,247,.35);
  }
  body{
    background-image: radial-gradient(1200px 400px at 10% -10%, #ffedd5 0, transparent 40%),
                      radial-gradient(1200px 400px at 110% 10%, #e0f2fe 0, transparent 42%),
                      radial-gradient(1200px 500px at 50% 120%, #f5d0fe 0, transparent 45%);
  }
  .logo{background:conic-gradient(from 180deg at 50% 50%, var(--brand), var(--brand-2), #f97316, var(--brand)); animation:spin 6s linear infinite;}
  .btn.primary{background:linear-gradient(90deg, var(--brand), #f97316, var(--brand-2));}
  .card{border-color:#e9d5ff;background:rgba(255,255,255,.9)}
  .wiggle{animation:wiggle 2.6s ease-in-out infinite}
  .float{animation:float 4s ease-in-out infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes wiggle{0%,100%{transform:rotate(0)}20%{transform:rotate(-6deg)}40%{transform:rotate(6deg)}60%{transform:rotate(-2deg)}80%{transform:rotate(2deg)}}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

  /* marquee styling */
  .marquee{display:flex;overflow:hidden;gap:24px;border:2px dashed #e9d5ff;border-radius:16px;padding:8px;background:#fff}
  .marquee track{display:flex;gap:18px;animation:scroll 20s linear infinite}
  .marquee img{height:56px;object-fit:cover;border-radius:10px;border:1px solid var(--line);box-shadow:0 4px 12px rgba(0,0,0,.06)}
  .marquee .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#fde68a,#fbcfe8);border:1px solid #fecdd3;font-weight:600}
  @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
  /* Extra glow effects */
  .glow{box-shadow:0 0 0 0 rgba(168,85,247,.45);animation:glowPulse 3s ease-in-out infinite}
  @keyframes glowPulse{0%{box-shadow:0 0 0 0 rgba(168,85,247,.35)}50%{box-shadow:0 0 24px 6px rgba(6,182,212,.3)}100%{box-shadow:0 0 0 0 rgba(168,85,247,.35)}}
  .btn:hover{box-shadow:0 8px 24px rgba(6,182,212,.25)}
  /* ===== Colorful FAQ styles ===== */
  .faq h2{background:linear-gradient(90deg,#a855f7,#06b6d4,#f97316);-webkit-background-clip:text;background-clip:text;color:transparent}
  .faq details{border:2px solid transparent;padding:0;border-radius:16px;overflow:hidden;background:rgba(255,255,255,.9);box-shadow:0 8px 24px rgba(0,0,0,.06);margin:10px 0}
  .faq details summary{list-style:none;cursor:pointer;padding:14px 16px;font-weight:700;display:flex;align-items:center;gap:10px;background:linear-gradient(90deg,#faf5ff,#ecfeff)}
  .faq details[open] summary{background:linear-gradient(90deg,#fff7ed,#f5f3ff)}
  .faq details > *:not(summary){padding:12px 16px}
  .faq .qbadge{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:999px;color:#fff;font-weight:800;background:linear-gradient(135deg,#a855f7,#06b6d4);box-shadow:0 4px 12px rgba(168,85,247,.35)}
  .faq details:nth-of-type(3n) .qbadge{background:linear-gradient(135deg,#f97316,#a855f7)}
  .faq details:nth-of-type(3n+1) .qbadge{background:linear-gradient(135deg,#06b6d4,#22c55e)}
  .faq details:nth-of-type(3n+2) .qbadge{background:linear-gradient(135deg,#eab308,#f43f5e)}
  .faq details:hover{transform:translateY(-1px);transition:.2s}
  /* Section color fills */
  .color1{background:linear-gradient(180deg,#fff,#f8f5ff)}
  .color2{background:linear-gradient(180deg,#fff,#ecfeff)}
  .color3{background:linear-gradient(180deg,#fff7ed,#fff)}
  .color4{background:linear-gradient(180deg,#f0f9ff,#fff)}
  .color5{background:linear-gradient(180deg,#fef9c3,#fff)}
  .color6{background:linear-gradient(180deg,#fdf2f8,#fff)}
  /* Floating help button */
  .helpfab{position:fixed;right:18px;bottom:18px;z-index:99;background:linear-gradient(135deg,#a855f7,#06b6d4);color:#fff;border:none;border-radius:999px;padding:14px 16px;box-shadow:0 12px 28px rgba(0,0,0,.2);cursor:pointer;display:flex;align-items:center;gap:8px}
  .helpfab:hover{transform:translateY(-2px)}
  .helpfab .pulse{width:10px;height:10px;border-radius:999px;background:#fff;box-shadow:0 0 0 0 rgba(255,255,255,.6);animation:pulse 2s ease-out infinite}
  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,255,255,.6)}70%{box-shadow:0 0 0 14px rgba(255,255,255,0)}100%{box-shadow:0 0 0 0 rgba(255,255,255,0)}}
  /* Animated ribbons under section headers */
  .ribbon{height:6px;border-radius:999px;background:linear-gradient(90deg,#06b6d4,#a855f7,#f97316,#06b6d4);background-size:200% 100%;animation:ribbon 6s linear infinite;margin:6px 0 12px}
  @keyframes ribbon{0%{background-position:0 0}100%{background-position:200% 0}}
  /* Moving background for color sections */
  .color1,.color2,.color3,.color4,.color5,.color6{background-size:200% 200%;animation:movebg 12s ease-in-out infinite}
  @keyframes movebg{0%{background-position:0% 0%}50%{background-position:100% 100%}100%{background-position:0% 0%}}
  @keyframes blink{0%,100%{opacity:.3}50%{opacity:.9}}
  @keyframes cursorMove{0%{left:6%;top:14%}25%{left:60%;top:14%}50%{left:60%;top:46%}75%{left:18%;top:70%}100%{left:6%;top:14%}}
  /* Phone preview + chart */
  .phone{width:320px;max-width:96%;aspect-ratio:9/19;border:10px solid #111;border-radius:36px;background:#000;box-shadow:0 16px 48px rgba(0,0,0,.35);position:relative;overflow:hidden}
  .phone .notch{position:absolute;top:0;left:50%;transform:translateX(-50%);width:40%;height:18px;background:#111;border-bottom-left-radius:12px;border-bottom-right-radius:12px}
  .phone .screen{position:absolute;inset:12px;background:linear-gradient(180deg,#0ea5e9 0,#a855f7 100%);padding:10px;border-radius:24px;display:flex;flex-direction:column;gap:8px}
  .phone .screen h4{color:#fff;margin:2px 0 0 0}
  .chartwrap{background:rgba(255,255,255,.9);border:1px solid var(--line);border-radius:12px;padding:8px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .controls input[type=range]{width:120px}
  /* Ask-the-expert floating button */
  .askfab{position:fixed;right:18px;bottom:18px;z-index:99;background:linear-gradient(135deg,#22c55e,#06b6d4);color:#fff;border:none;border-radius:999px;padding:14px 16px;box-shadow:0 12px 28px rgba(0,0,0,.2);cursor:pointer;display:flex;align-items:center;gap:10px}
  .askfab:hover{transform:translateY(-2px)}
  .askfab .pulse{width:10px;height:10px;border-radius:999px;background:#fff;box-shadow:0 0 0 0 rgba(255,255,255,.6);animation:pulse 2s ease-out infinite}
  /* Ask-the-expert & secondary help button */
  .askfab{position:fixed;right:18px;bottom:18px;z-index:100;background:linear-gradient(135deg,#22c55e,#06b6d4);color:#fff;border:none;border-radius:999px;padding:14px 16px;box-shadow:0 12px 28px rgba(0,0,0,.2);cursor:pointer;display:flex;align-items:center;gap:10px}
  .askfab:hover{transform:translateY(-2px)}
  .askfab .pulse{width:10px;height:10px;border-radius:999px;background:#fff;box-shadow:0 0 0 0 rgba(255,255,255,.6);animation:pulse 2s ease-out infinite}
  .helpfab2{position:fixed;right:18px;bottom:78px;z-index:100;background:linear-gradient(135deg,#a855f7,#06b6d4);color:#fff;border:none;border-radius:999px;padding:10px 12px;box-shadow:0 12px 28px rgba(0,0,0,.2);cursor:pointer}
  /* Disable marquee scroll when using single track */
  .marquee .track.single{animation:none}
  /* ‚úÖ Copied! badge for copy buttons */
  .btn{position:relative}
  .copied-badge{position:absolute; right:-6px; top:-8px; background:#22c55e; color:#fff; font-size:12px; padding:4px 8px; border-radius:999px; box-shadow:0 6px 16px rgba(34,197,94,.35); animation:copypop .9s ease forwards}
  @keyframes copypop{0%{transform:translateY(6px) scale(.9); opacity:0}30%{transform:translateY(-4px) scale(1); opacity:1}100%{transform:translateY(-16px) scale(.98); opacity:0}}
</style>
<script src="https://media.twiliocdn.com/sdk/js/conversations/v2/twilio-conversations.min.js"></script>

</head>
<script>
  // Function to show "‚úÖ Copied!" animation
  function showCopied(el) {
    const tag = document.createElement('span');
    tag.className = 'copied-badge';
    tag.textContent = '‚úÖ Copied!';
    el.style.position = 'relative';
    el.appendChild(tag);
    setTimeout(() => tag.remove(), 1000);
  }

  // Universal Copy function with fallback
  function copyText(text, el) {
    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(text)
        .then(() => showCopied(el))
        .catch(() => fallbackCopy(text, el));
    } else {
      fallbackCopy(text, el);
    }
  }

  // Fallback for insecure or older browsers
  function fallbackCopy(text, el) {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    try {
      document.execCommand('copy');
      showCopied(el);
    } catch (err) {
      alert('Please copy manually: ' + text);
    }
    document.body.removeChild(ta);
  }

  // Attach to all buttons with data-copy
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('button[data-copy]').forEach(btn => {
      btn.addEventListener('click', () => {
        const text = btn.getAttribute('data-copy') || '';
        copyText(text, btn);
      });
    });
  });
</script>

<style>
  .copied-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #22c55e;
    color: white;
    padding: 3px 7px;
    font-size: 12px;
    border-radius: 6px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    animation: popFade 1s ease forwards;
  }
  @keyframes popFade {
    0% { transform: scale(0.9); opacity: 0; }
    30% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 0; top: -20px; }
  }
</style>

<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">Complex Case Discharge Delay ‚Äî Albuquerque Hospitals Pilot</div>
          <div class="muted" style="font-size:12px">Interactive survey instructions & data collection guide</div>
        </div>
      </div>
      <div class="row">
        <button class="btn" id="themeToggle" aria-pressed="false" title="Toggle dark mode">üåô Theme</button>
        <button class="btn" id="printBtn" title="Print or save as PDF">üñ®Ô∏è Print</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- colorful marquee with images -->
    <div class="marquee" aria-label="Highlights">
      <div class="track single">
        <span class="badge">üóìÔ∏è Monthly reporting</span>
        <span class="badge">üè• Albuquerque hospitals</span>
        <span class="badge">‚úÖ Inclusion checklist</span>
        <span class="badge">üîê No Protected Health Information (PHI) collected</span>
      </div>
    </div>
    <section class="hero card color1 glow" role="region" aria-label="Overview">
      <div>
        <p class="pill">üìå Pilot window & access ¬∑ <span class="muted">See Steps 1‚Äì3 below</span></p>
        <h1 class="big">Complex Case Discharge Delay ‚Äî Albuquerque Hospitals Pilot</h1>
        <p class="sub">This interactive guide walks teams through <strong>what to collect</strong> and <strong>how to report cases</strong>. Use the quick actions to expand sections, practice with the demo form, and print a training PDF.</p>
        <div class="row" style="margin-top:12px">
          <button id="startGuideBtn" class="btn primary" onclick="scrollToEl('#steps')">Start the 3‚Äëstep guide</button>
          <button id="openGlossaryBtn" class="btn" onclick="scrollToEl('#glossary')">Open glossary</button>
        </div>
      </div>
      <div class="card" aria-label="Quick actions" style="border-style:dashed">
        <div class="row" style="flex-wrap:wrap;gap:8px">
          <button class="btn" onclick="expandAll()">‚ûï Expand all</button>
          <button class="btn" onclick="collapseAll()">‚ûñ Collapse all</button>
          <button class="btn" onclick="checkAll(true)">‚òëÔ∏è Check all</button>
          <button class="btn" onclick="checkAll(false)">‚¨ú Clear all</button>
          <button class="btn" onclick="openDemo()">üß™ Demo form</button>
          <button class="btn" id="printBtn2">üñ®Ô∏è Print</button>
        </div>
        <p class="inline-help" style="margin-top:8px">Tip: Your checklist selections are saved in this browser.</p>
      </div>
    </section>

    <section class="card color2 glow" aria-label="Clip art">
      <h2 style="margin-top:0">Quick visual guide</h2>
      <div class="row" style="gap:16px;flex-wrap:wrap">
        <!-- Clip art: clock -->
        <svg class="wiggle" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="border:1px solid var(--line);border-radius:12px;padding:10px"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
        <!-- Clip art: hospital -->
        <svg class="float" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="border:1px solid var(--line);border-radius:12px;padding:10px"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M12 7v6M9 10h6"/></svg>
        <!-- Clip art: checklist -->
        <svg class="wiggle" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="border:1px solid var(--line);border-radius:12px;padding:10px"><rect x="4" y="3" width="16" height="18" rx="2"/><path d="M8 7h8M8 11h8M8 15h5"/><path d="m7 20 1.5-2 1 1.2"/></svg>
        <!-- Clip art: upload/report -->
        <svg class="float" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="border:1px solid var(--line);border-radius:12px;padding:10px"><path d="M12 16V4"/><path d="m7 9 5-5 5 5"/><rect x="3" y="14" width="18" height="7" rx="2"/></svg>
        <!-- Motion image -->
        
      </div>
      <p class="inline-help">These icons reflect key actions: timing (clock), setting (hospital), inclusion checklist, and reporting. Enjoy the motion hints!</p>
    </section>

    <section id="steps" class="grid cols-3">
      <div class="card color3 glow">
        <h2>Step 1 ¬∑ Collect data <span class="tag">Internal first</span></h2><div class="ribbon"></div>
        <p class="inline-help">Gather cases that meet <em>all</em> inclusion criteria. You may optionally add cases with fewer avoidable days.</p>
        <details open>
          <summary>Inclusion Criteria</summary>
          <ul class="checklist" data-list="s1">
            <li><input type="checkbox"> <label>Discharge delays <strong>&gt;96 avoidable hours</strong> (ED &gt;4 days) <em>and/or</em> <strong>&gt;336 avoidable hours</strong> (&gt;14 days)</label></li>
            <li><input type="checkbox"> <label>Present in hospital between <strong>April 1</strong> and <strong>June 30</strong></label></li>
            <li><input type="checkbox"> <label><strong>Not</strong> in a swing bed</label></li>
            <li><input type="checkbox"> <label>Optional: include cases with fewer avoidable days (note as <em>below-threshold</em>)</label></li>
          </ul>
        </details>
        <details>
          <summary>Tips for consistency</summary>
          <ul>
            <li>Use the downloadable template (CSV/XLSX) to stage case details internally.</li>
            <li>Verify <em>avoidable hours/days</em> and classification (see glossary).</li>
            <li>Document data sources (EHR, case management notes, bed management logs).</li>
          </ul>
        </details>
        
      </div>

      <div class="card color4 glow">
        <h2>Step 2 ¬∑ Report cases <span class="tag">Monthly cadence</span></h2><div class="ribbon"></div>
        <p class="inline-help">Report at least once a month (example cadence: May 9, June 8, July 8).</p>
        <details open>
          <summary>How to add a case</summary>
          <ol class="checklist" data-list="s3">
            <li><input type="checkbox"> <label>Sign in to the pilot application</label></li>
            <li><input type="checkbox"> <label>Go to <strong>Case Management</strong></label></li>
            <li><input type="checkbox"> <label>Select your <strong>Hospital Name</strong> from the dropdown</label></li>
            <li><input type="checkbox"> <label>Click <strong>Add New Case</strong></label></li>
            <li><input type="checkbox"> <label>Enter required case information and <strong>Save</strong></label></li>
          </ol>
        </details>
        <details>
          <summary>Edit or delete a case</summary>
          <ol>
            <li>Sign in ‚Üí Case Management ‚Üí select your hospital</li>
            <li>Find the case (crosswalk by ID or case characteristics)</li>
            <li>Click <strong>Edit</strong> (proceed as with adding) or <strong>Delete</strong> to remove</li>
          </ol>
          <p class="inline-help">Incomplete cases are highlighted <span class="kbd">yellow</span> on the homepage.</p>
        </details>
        <div class="row" style="margin-top:10px">
          <button class="btn primary glow" onclick="openDemo()">üé¨ Watch & Try the Demo</button>
          <button class="btn" onclick="copyText('Report monthly by the agreed cadence (e.g., May 9, June 8, July 8).')">üìã Copy reminder text</button>
        </div>
      </div>
    </section>

    <section class="card color6 glow" id="glossary" aria-label="Glossary & definitions">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>Glossary & Definitions</h2>
        <div class="ribbon"></div>
        <input class="search" id="search" placeholder="Search terms (e.g., avoidable hours, guardianship, placement)" aria-label="Filter glossary" />
      </div>
      <dl class="glossary" id="gloss">
        <dt>Avoidable hours/days</dt>
        <dd>Time when a patient is stabilized and ready for discharge but cannot be discharged due to non-medical barriers.</dd>
        <dt>Placement setting days</dt>
        <dd>Days from the first placement request to the notice that placement is available.</dd>
        <dt>Insurance or financial coverage days</dt>
        <dd>Days from the first coverage request to the final determination notice.</dd>
        <dt>Agency service/program eligibility process days</dt>
        <dd>Days from the first request to the final eligibility determination notice.</dd>
        <dt>Agency service/program referral process days</dt>
        <dd>Days from the first request to the final referral determination notice.</dd>
        <dt>Placement setting screening days</dt>
        <dd>Days from screening initiation to receipt of the screening determination notice.</dd>
        <dt>Guardianship days</dt>
        <dd>Days from guardianship process initiation to finalization.</dd>
        <dt>Advanced care planning days</dt>
        <dd>Days from planning initiation to completion (e.g., health proxy).</dd>
        <dt>Inactivity timeout</dt>
        <dd>Users are logged out automatically after 15 minutes without activity.</dd>
      </dl>
      <div class="print-note">Tip: Use <span class="kbd">Ctrl/‚åò+P</span> to save this page as a PDF for training materials.</div>
    </section>

    
      <section class="card faq color6 glow" aria-label="FAQ">
      <h2>FAQ ‚Äî Complex Case Data Collection (Albuquerque Hospitals)</h2>
      <details open>
        <summary><span class="qbadge">1</span> üóìÔ∏è When are the data due?</summary>
        <p>Report data at least once a month (e.g., May 9, June 8, July 8). Cases that meet the inclusion criteria should be reported once after discharge, or in July if not discharged during the 90‚Äëday period. If a patient is discharged and later returns and meets the criteria again, report the patient again.</p>
        <ul>
          <li>Example: Admitted Mar 21, discharged May 10 ‚Üí report in June.</li>
          <li>Same patient returns Jun 4 and not discharged by Jun 30 ‚Üí report again in July.</li>
        </ul>
      </details>
      <details>
        <summary><span class="qbadge">2</span> üè• What patients are included?</summary>
        <p>Patients with discharge delays &gt;96 avoidable hours (&gt;4 days) in the emergency department and/or &gt;336 avoidable hours (&gt;14 days), excluding patients in swing beds.</p>
      </details>
      <details>
        <summary><span class="qbadge">3</span> ‚è±Ô∏è How do you define avoidable hours/days?</summary>
        <p>Hours/days when a patient is stabilized and ready for discharge but is unable to be discharged.</p>
      </details>
      <details>
        <summary><span class="qbadge">4</span> üîê Will my hospital or health system name be shared?</summary>
        <p>Data used for advocacy will not include any hospital‚Äëspecific identification unless written permission is provided. Information collected will not include protected health information.</p>
      </details>
      <details>
        <summary><span class="qbadge">5</span> üìÖ Are you looking for admissions that start after April 1?</summary>
        <p>Include patients who were in your institution during the 90‚Äëday data collection period (Apr 1 ‚Äì Jun 30) and who meet the inclusion criteria, regardless of admission date.</p>
      </details>
      <details>
        <summary><span class="qbadge">6</span> üß© Are you including all lines of business?</summary>
        <p>Yes. Patients in all lines of service are included.</p>
      </details>
      <details>
        <summary><span class="qbadge">7</span> ü©∫ Will observation status be grouped as ED or inpatient?</summary>
        <p>Observation status will be grouped as ED for this pilot.</p>
      </details>
      <details>
        <summary><span class="qbadge">8</span> üåê Are you including undocumented/uninsured patients?</summary>
        <p>Yes. Undocumented/uninsured patients are an important group for this pilot.</p>
      </details>
      <details>
        <summary><span class="qbadge">9</span> üõèÔ∏è Are you including patients with swing bed status?</summary>
        <p>No. Patients with swing bed status are excluded because they do not provide sufficient meaningful data for this pilot.</p>
      </details>
      <details>
        <summary><span class="qbadge">10</span> üß† Are patients awaiting behavioral health placements included?</summary>
        <p>Yes. Report all patients who meet the inclusion criteria.</p>
      </details>
      <details>
        <summary><span class="qbadge">11</span> üßæ Does this include alternative level of care (ALC) patients?</summary>
        <p>Yes. Please include ALC‚Äëdesignated patients.</p>
      </details>
      <details>
        <summary><span class="qbadge">12</span> ‚úâÔ∏è Can we submit data outside the portal if we already collect these data?</summary>
        <p>Yes, if your data elements match those requested for this pilot. Coordinate with the pilot support contact for submission options.</p>
      </details>
      <details>
        <summary><span class="qbadge">13</span> üìä If data are submitted as a system, will site‚Äëlevel detail be provided?</summary>
        <p>Yes. Reports will include system‚Äëlevel and hospital‚Äëlevel detail. Participants will also receive raw data.</p>
      </details>
    </section>
      <section class="card color5 glow" aria-label="Survey window">
      <h2>Survey window</h2>
      <div class="ribbon"></div>
      <div class="marquee" role="region" aria-label="Survey dates">
        <div class="track">
          <span class="badge">üöÄ Start: <strong>November 10, 2025</strong></span>
          <span class="badge">‚è≥ Ends: <strong>December 10, 2025</strong></span>
          <span class="badge">‚è±Ô∏è Time left: <strong id="countdown">calculating‚Ä¶</strong></span>
          <span class="badge">üì£ Submit before the deadline!</span>
        </div>
      </div>
    </section>

    
    

    <section id="emailSnippets" class="card color6 glow" aria-label="Email snippets">
      <h2>Email snippets</h2>
      <div class="ribbon"></div>
      <div class="card" style="border-style:dashed">
        <p class="inline-help">One‚Äëclick copy or launch an email draft. Primary contact: <span class="kbd">ktripurari@salud.unm.edu</span></p>
        <div class="row" style="gap:8px;flex-wrap:wrap">
          <a class="btn glow" href="mailto:ktripurari@salud.unm.edu?subject=Albuquerque%20Pilot%20%E2%80%94%20Question%2FSupport&body=Hello%20Koushik%2C%0A%0AI%20have%20a%20question%20about%20the%20Complex%20Case%20Discharge%20Delay%20pilot.%20Could%20you%20help%20me%20with%E2%80%A6%0A%0AThanks%2C">‚úâÔ∏è Start email to KT</a>
          <button class="btn" data-copy="ktripurari@salud.unm.edu">üìã Copy KT email address</button>

          <button class="btn" data-copy="Requesting access to the complex case discharge delay pilot application. Please enable my account and send the Okta activation link.">üîë Copy access request</button>
          <a class="btn" href="mailto:ktripurari@salud.unm.edu?subject=Access%20request%20%E2%80%94%20Complex%20Case%20Pilot&body=Hello%20Koushik%2C%0A%0APlease%20enable%20my%20access%20to%20the%20Complex%20Case%20Discharge%20Delay%20pilot%20application%20and%20send%20the%20Okta%20activation%20link.%0A%0AHospital%2FDept%3A%20%0ARole%3A%20%0APhone%3A%20%0A%0AThank%20you%2C">üîó Start access request email</a>

          <button class="btn" data-copy="For technical support related to this pilot, please contact ktripurari@salud.unm.edu.">üõ†Ô∏è Copy tech support line</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Demo modal -->
  <dialog id="demo" style="border:none;border-radius:16px;max-width:820px;width:92%;padding:0">
    <form method="dialog" class="card" style="margin:0">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">Demo ‚Äî Add New Case</h3>
        <button class="btn" value="close">‚úñ Close</button>
      </div>
      <!-- Custom video-like guided animation (no external hosting) -->
      <div class="card glow" style="border-style:dashed;position:relative;overflow:hidden">
        <p class="inline-help">Guided walkthrough: watch the pointer fill the form, then try it yourself below.</p>
        <div class="demo-video" style="position:relative;border:1px solid var(--line);border-radius:12px;padding:16px;background:linear-gradient(180deg,#fff,#f8faff)">
          <div class="demo-field" style="height:38px;border:1px solid var(--line);border-radius:10px;margin-bottom:10px;position:relative;overflow:hidden">
            <span class="inline-help" style="position:absolute;left:10px;top:8px">Hospital Name</span>
            <div class="highlight" style="position:absolute;inset:0;background:rgba(6,182,212,.12);animation:blink 3s infinite"></div>
          </div>
          <div class="demo-field" style="height:38px;border:1px solid var(--line);border-radius:10px;margin-bottom:10px;position:relative">
            <span class="inline-help" style="position:absolute;left:10px;top:8px">Ready for Discharge (date)</span>
          </div>
          <div class="demo-field" style="height:38px;border:1px solid var(--line);border-radius:10px;margin-bottom:10px;position:relative">
            <span class="inline-help" style="position:absolute;left:10px;top:8px">Avoidable hours</span>
          </div>
          <div class="demo-field" style="height:38px;border:1px solid var(--line);border-radius:10px;position:relative">
            <span class="inline-help" style="position:absolute;left:10px;top:8px">Setting</span>
          </div>
          <div class="cursor" style="width:16px;height:16px;border-radius:50%;background:var(--brand);position:absolute;left:6%;top:14%;box-shadow:0 0 0 6px rgba(14,165,233,.15);animation:cursorMove 7s ease-in-out infinite"></div>
        </div>
      </div>
      <details open>
        <summary><strong>Open interactive demo form</strong></summary>
        <div class="sbs">
          <label>Hospital Name
            <select class="search" required>
              <option value="">Select‚Ä¶</option>
              <option>Hospital A</option>
              <option>Hospital B</option>
            </select>
          </label>
          <label>Patient Ready for Discharge (date)
            <input class="search" type="date" required>
          </label>
          <label>Discharge Date (actual)
            <input class="search" type="date" required>
          </label>
          <label>Avoidable hours (numeric)
            <input class="search" type="number" min="0" step="1" placeholder="e.g., 120" required>
          </label>
          <label>Setting
            <select class="search">
              <option>ED</option>
              <option>Inpatient</option>
            </select>
          </label>
          <label>Notes
            <textarea class="search" rows="3" placeholder="Barriers, guardianship status, placement status‚Ä¶"></textarea>
          </label>
        </div>
        <div class="row" style="margin-top:12px;justify-content:flex-end">
          <button class="btn primary" onclick="toast('This is a demo only ‚Äî data is not submitted.')">Save (demo)</button>
        </div>
      </details>
    </form>
  </dialog>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
  // ===== Helpers =====
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const toastEl = $('#toast');
  function toast(msg){
    toastEl.textContent = msg; toastEl.classList.add('show');
    setTimeout(()=>toastEl.classList.remove('show'), 2200);
  }
  function scrollToEl(sel){ document.querySelector(sel).scrollIntoView({behavior:'smooth'}); }
  function copyText(t, el){
    const onOK = ()=>{ try{ toast('Copied to clipboard'); }catch(e){}; try{ if(el) showCopied(el); }catch(e){} };
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(t).then(onOK).catch(()=> fallbackCopy(t, el));
    } else { fallbackCopy(t, el); }
  }
  function fallbackCopy(t, el){
    try{
      const ta = document.createElement('textarea');
      ta.value = t; ta.style.position='fixed'; ta.style.opacity='0';
      document.body.appendChild(ta); ta.focus(); ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      if(ok){ try{ toast('Copied to clipboard'); }catch(e){}; try{ if(el) showCopied(el); }catch(e){} }
      else { toast('Select and copy manually'); }
    }catch(e){ toast('Select and copy manually'); }
  } else {
      fallbackCopy(t);
    }
  }
  function fallbackCopy(t){
    try{
      const ta = document.createElement('textarea');
      ta.value = t; ta.style.position='fixed'; ta.style.opacity='0';
      document.body.appendChild(ta); ta.focus(); ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      toast(ok ? 'Copied to clipboard' : 'Select and copy manually');
    }catch(e){ toast('Select and copy manually'); }
  }
  function showCopied(el){
    try{
      const tag=document.createElement('span');
      tag.className='copied-badge';
      tag.textContent='‚úÖ Copied!';
      el.appendChild(tag);
      setTimeout(()=>{ try{ tag.remove(); }catch(e){} }, 950);
    }catch(e){}
  }catch(e){ toast('Select and copy manually'); }
  }

  // ===== Theme toggle =====
  const themeBtn = $('#themeToggle');
  const savedTheme = localStorage.getItem('theme');
  if(savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
  themeBtn.addEventListener('click',()=>{
    const cur = document.documentElement.getAttribute('data-theme');
    const next = cur === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    themeBtn.setAttribute('aria-pressed', next==='dark');
  });

  // ===== Print =====
  $('#printBtn').addEventListener('click',()=>window.print());

  // ===== Checklist state with localStorage (no progress bar) =====
  const lists = ['s1','s2','s3'];
  const key = 'hanys-progress-v1';
  function loadState(){
    const raw = JSON.parse(localStorage.getItem(key) || '{}');
    lists.forEach(id=>{
      const boxes = document.querySelectorAll(`[data-list="${id}"] input[type="checkbox"]`);
      boxes.forEach((box, i)=>{ box.checked = !!raw[`${id}-${i}`]; box.addEventListener('change',saveState);});
    });
  }
  function saveState(){
    const out={};
    lists.forEach(id=>{
      const boxes = document.querySelectorAll(`[data-list="${id}"] input[type="checkbox"]`);
      boxes.forEach((box,i)=> out[`${id}-${i}`]=box.checked);
    });
    localStorage.setItem(key, JSON.stringify(out));
  }
  loadState();

  // Expand/Collapse & Check helpers
  function expandAll(){ document.querySelectorAll('details').forEach(d=> d.open=true); }
  function collapseAll(){ document.querySelectorAll('details').forEach(d=> d.open=false); }
  function checkAll(val){ document.querySelectorAll('input[type="checkbox"]').forEach(b=>{ b.checked=val; }); saveState(); }

  // Secondary print button
  document.addEventListener('DOMContentLoaded',()=>{ const p2=document.getElementById('printBtn2'); if(p2){ p2.addEventListener('click',()=>window.print()); } });

  // ===== Glossary search =====
  const gloss = $('#gloss');
  $('#search').addEventListener('input', (e)=>{
    const q = e.target.value.toLowerCase();
    const nodes = gloss.querySelectorAll('dt,dd');
    // Hide all then show matches in pairs
    const entries=[]; let curTerm=null;
    nodes.forEach(n=>{ if(n.tagName==='DT'){ curTerm=n; entries.push({dt:curTerm, dd:curTerm.nextElementSibling}); } });
    entries.forEach(({dt,dd})=>{
      const hit = dt.textContent.toLowerCase().includes(q) || dd.textContent.toLowerCase().includes(q);
      dt.style.display = dd.style.display = (q && !hit) ? 'none' : '';
    });
  });

  // ===== Demo dialog =====
  function openDemo(){ $('#demo').showModal(); }
  window.openDemo = openDemo;

   $('#dateInput').value=''; toast('Date added');
  }
  function delDate(i){
    const items = JSON.parse(localStorage.getItem(dkey) || '[]');
    items.splice(i,1); localStorage.setItem(dkey, JSON.stringify(items)); renderDates();
  }
  function clearDates(){ localStorage.removeItem(dkey); renderDates(); }
  renderDates();

  // ===== Email helpers & timeline & countdown & live chart & expert dialog =====
  function startEmail(addr, subject, body){
    const url = `mailto:${addr}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = url;
    toast('Opening your email client‚Ä¶');
  }
  function openExpert(){
    const dlg = document.getElementById('expert'); if(!dlg) return; dlg.showModal();
    const msgEl = document.getElementById('expertMsg');
    const emailBtn = document.getElementById('expertEmailBtn');
    const smsBtn = document.getElementById('expertSMSBtn');
    const status = document.getElementById('expertStatus');
    const enable = ()=>{
      const has = (msgEl.value||'').trim().length>0;
      emailBtn.disabled = smsBtn.disabled = !has;
    };
    enable(); msgEl.addEventListener('input', enable);
    emailBtn.onclick = ()=>{
      const body = `${msgEl.value}

‚Äî Sent from Ask‚Äëthe‚ÄëExpert widget (${new Date().toLocaleString()})`;
      startEmail('ktripurari@salud.unm.edu','Ask the Expert ‚Äî Question', body);
      status.textContent = 'Opening your email app‚Ä¶';
    };
    smsBtn.onclick = ()=>{
      const body = `${msgEl.value} ‚Äî Ask‚Äëthe‚ÄëExpert (${new Date().toLocaleString()})`;
      window.location.href = `sms:+13175839106?&body=${encodeURIComponent(body)}`;
      status.textContent = 'Opening your texting app‚Ä¶';
    };
    msgEl.focus();
  }
  // Countdown to Dec 10, 2025
  (function countdown(){
    const el = document.getElementById('countdown'); if(!el) return;
    const end = new Date('2025-12-10T23:59:59');
    function tick(){
      const now = new Date();
      let diff = Math.max(0, end - now);
      const d = Math.floor(diff/86400000); diff -= d*86400000;
      const h = Math.floor(diff/3600000); diff -= h*3600000;
      const m = Math.floor(diff/60000); diff -= m*60000;
      const s = Math.floor(diff/1000);
      el.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }
    tick(); setInterval(tick, 1000);
  })();

  // Live interactive chart (vanilla canvas)
  const lc = document.getElementById('liveChart');
  const ctx = lc ? lc.getContext('2d') : null;
  let data = [40,65,58,72,50,88,60];
  function draw(){
    if(!ctx) return; const w=lc.width, h=lc.height; ctx.clearRect(0,0,w,h);
    // axes
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(30,10); ctx.lineTo(30,h-20); ctx.lineTo(w-10,h-20); ctx.stroke();
    // line
    const max = Math.max(120, ...data), min = 0;
    const xstep = (w-50)/(data.length-1||1);
    ctx.strokeStyle = '#06b6d4'; ctx.lineWidth=2; ctx.beginPath();
    data.forEach((v,i)=>{
      const x = 30 + i*xstep; const y = (h-20) - (v-min)/(max-min)*(h-40);
      i? ctx.lineTo(x,y): ctx.moveTo(x,y);
    });
    ctx.stroke();
    // points
    ctx.fillStyle = '#a855f7';
    data.forEach((v,i)=>{
      const x = 30 + i*xstep; const y = (h-20) - (v-min)/(max-min)*(h-40);
      ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
    });
  }
  function addPoint(){ const s=document.getElementById('valSlider'); if(!s) return; data.push(+s.value); if(data.length>12) data.shift(); draw(); toast('Point added'); }
  function randomize(){ data = Array.from({length:7},()=> Math.round(Math.random()*120)); draw(); toast('Chart randomized'); }
  if(ctx){ draw(); }

  function startEmail(addr, subject, body){
    const url = `mailto:${addr}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = url;
    toast('Opening your email client‚Ä¶');
  }
  function openExpert(){
    const dlg = document.getElementById('expert'); if(dlg) dlg.showModal();
    const msg = document.getElementById('expertMsg'); if(msg) msg.focus();
    // wire links on each open to latest text
    const email = document.getElementById('expertEmail');
    const sms = document.getElementById('expertSMS');
    const build = ()=>{
      const body = (document.getElementById('expertMsg').value||'').trim() || 'Hello, I need assistance with‚Ä¶';
      email.href = `mailto:ktripurari@salud.unm.edu?subject=Ask%20the%20Expert%20‚Äî%20Question&body=${encodeURIComponent(body)}`;
      sms.href = `sms:+13175839106?&body=${encodeURIComponent(body)}`;
    };
    build();
    document.getElementById('expertMsg').addEventListener('input', build, {once:false});
  }
  // Countdown to Dec 10, 2025
  (function countdown(){
    const el = document.getElementById('countdown'); if(!el) return;
    const end = new Date('2025-12-10T23:59:59');
    function tick(){
      const now = new Date();
      let diff = Math.max(0, end - now);
      const d = Math.floor(diff/86400000); diff -= d*86400000;
      const h = Math.floor(diff/3600000); diff -= h*3600000;
      const m = Math.floor(diff/60000); diff -= m*60000;
      const s = Math.floor(diff/1000);
      el.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }
    tick(); setInterval(tick, 1000);
  })();

  // Live interactive chart (vanilla canvas)
  const lc = document.getElementById('liveChart');
  const ctx = lc ? lc.getContext('2d') : null;
  let data = [40,65,58,72,50,88,60];
  function draw(){
    if(!ctx) return; const w=lc.width, h=lc.height; ctx.clearRect(0,0,w,h);
    // axes
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(30,10); ctx.lineTo(30,h-20); ctx.lineTo(w-10,h-20); ctx.stroke();
    // line
    const max = Math.max(120, ...data), min = 0;
    const xstep = (w-50)/(data.length-1||1);
    ctx.strokeStyle = '#06b6d4'; ctx.lineWidth=2; ctx.beginPath();
    data.forEach((v,i)=>{
      const x = 30 + i*xstep; const y = (h-20) - (v-min)/(max-min)*(h-40);
      i? ctx.lineTo(x,y): ctx.moveTo(x,y);
    });
    ctx.stroke();
    // points
    ctx.fillStyle = '#a855f7';
    data.forEach((v,i)=>{
      const x = 30 + i*xstep; const y = (h-20) - (v-min)/(max-min)*(h-40);
      ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
    });
  }
  function addPoint(){ const s=document.getElementById('valSlider'); if(!s) return; data.push(+s.value); if(data.length>12) data.shift(); draw(); toast('Point added'); }
  function randomize(){ data = Array.from({length:7},()=> Math.round(Math.random()*120)); draw(); toast('Chart randomized'); }
  if(ctx){ draw(); }

  function startEmail(addr, subject, body){
    const url = `mailto:${addr}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = url;
    toast('Opening your email client‚Ä¶');
  }
  // Countdown to Dec 10, 2025
  (function countdown(){
    const el = document.getElementById('countdown'); if(!el) return;
    const end = new Date('2025-12-10T23:59:59');
    function tick(){
      const now = new Date();
      let diff = Math.max(0, end - now);
      const d = Math.floor(diff/86400000); diff -= d*86400000;
      const h = Math.floor(diff/3600000); diff -= h*3600000;
      const m = Math.floor(diff/60000); diff -= m*60000;
      const s = Math.floor(diff/1000);
      el.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }
    tick(); setInterval(tick, 1000);
  })();

  // Live interactive chart (vanilla canvas)
  const lc = document.getElementById('liveChart');
  const ctx = lc ? lc.getContext('2d') : null;
  let data = [40,65,58,72,50,88,60];
  function draw(){
    if(!ctx) return; const w=lc.width, h=lc.height; ctx.clearRect(0,0,w,h);
    // axes
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(30,10); ctx.lineTo(30,h-20); ctx.lineTo(w-10,h-20); ctx.stroke();
    // line
    const max = Math.max(120, ...data), min = 0;
    const xstep = (w-50)/(data.length-1||1);
    ctx.strokeStyle = '#06b6d4'; ctx.lineWidth=2; ctx.beginPath();
    data.forEach((v,i)=>{
      const x = 30 + i*xstep; const y = (h-20) - (v-min)/(max-min)*(h-40);
      i? ctx.lineTo(x,y): ctx.moveTo(x,y);
    });
    ctx.stroke();
    // points
    ctx.fillStyle = '#a855f7';
    data.forEach((v,i)=>{
      const x = 30 + i*xstep; const y = (h-20) - (v-min)/(max-min)*(h-40);
      ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
    });
  }
  function addPoint(){ const s=document.getElementById('valSlider'); if(!s) return; data.push(+s.value); if(data.length>12) data.shift(); draw(); toast('Point added'); }
  function randomize(){ data = Array.from({length:7},()=> Math.round(Math.random()*120)); draw(); toast('Chart randomized'); }
  if(ctx){ draw(); }

  function startEmail(addr, subject, body){
    const url = `mailto:${addr}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = url;
    toast('Opening your email client‚Ä¶');
  }
  // Countdown to Dec 10, 2025
  (function countdown(){
    const el = document.getElementById('countdown'); if(!el) return;
    const end = new Date('2025-12-10T23:59:59');
    function tick(){
      const now = new Date();
      let diff = Math.max(0, end - now);
      const d = Math.floor(diff/86400000); diff -= d*86400000;
      const h = Math.floor(diff/3600000); diff -= h*3600000;
      const m = Math.floor(diff/60000); diff -= m*60000;
      const s = Math.floor(diff/1000);
      el.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }
    tick(); setInterval(tick, 1000);
  })();

  // Keep timeline util (if used elsewhere)

  function startEmail(addr, subject, body){
    const url = `mailto:${addr}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = url;
    toast('Opening your email client‚Ä¶');
  }
  function loadTimeline(){
    const t = JSON.parse(localStorage.getItem('timeline')||'{}');
    if(t.start) document.getElementById('surveyStart').value = t.start;
    if(t.deadline) document.getElementById('surveyDeadline').value = t.deadline;
    updateDeadlineMsg();
  }
  function saveTimeline(){
    const start = document.getElementById('surveyStart').value;
    const deadline = document.getElementById('surveyDeadline').value;
    localStorage.setItem('timeline', JSON.stringify({start, deadline}));
    updateDeadlineMsg();
    toast('Timeline saved');
  }
  function daysBetween(a,b){ const ms=24*60*60*1000; return Math.round((b-a)/ms); }
  function updateDeadlineMsg(){
    const p = document.getElementById('deadlineMsg');
    const s = document.getElementById('surveyStart').value;
    const d = document.getElementById('surveyDeadline').value;
    if(!s || !d){ p.textContent = 'Set dates to see countdown.'; return; }
    const sd = new Date(s), dd = new Date(d), now = new Date();
    if(now < sd){ p.textContent = `Survey starts in ${daysBetween(now, sd)} day(s). Deadline is ${d}.`; }
    else if(now >= sd && now <= dd){ p.textContent = `Survey is live. ${daysBetween(now, dd)} day(s) until the deadline (${d}).`; }
    else { p.textContent = `Survey window ended on ${d}.`; }
  }
  document.addEventListener('DOMContentLoaded', loadTimeline);

  
</script>
  <button class="helpfab" onclick="document.getElementById('emailSnippets').scrollIntoView({behavior:'smooth'}); startEmail('ktripurari@salud.unm.edu','Need help ‚Äî Complex Case Pilot','Hello, I need assistance with‚Ä¶');" title="Get help">
    <span class="pulse"></span> Help
  </button>
  <button class="askfab" onclick="openExpert()" title="Ask the expert">
    <span class="pulse"></span> Ask the Expert
  </button>
  <button class="helpfab2" onclick="document.getElementById('emailSnippets').scrollIntoView({behavior:'smooth'});" title="Help via email">üìß Help</button>
  <!-- Ask the Expert dialog -->
  <dialog id="expert" style="border:none;border-radius:16px;max-width:640px;width:92%;padding:0">
    <form method="dialog" class="card" style="margin:0">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">Ask the Expert</h3>
        <button class="btn" value="close">‚úñ Close</button>
      </div>
      <p class="inline-help">Type your question below and choose how to send it. Message text is required.</p>
      <textarea id="expertMsg" class="search" rows="6" placeholder="Your question or message‚Ä¶" required></textarea>
      <div class="row" style="justify-content:flex-end;margin-top:10px">
        <button class="btn" type="button" id="expertEmailBtn" disabled>‚úâÔ∏è Send Email</button>
        <button class="btn primary" type="button" id="expertSMSBtn" disabled>üí¨ Send Text</button>
      </div>
      <p class="inline-help" id="expertStatus"></p>
    </form>
  </dialog>

  <button class="askfab" onclick="openExpert()" title="Ask the expert">
    <span class="pulse"></span> Ask the Expert
  </button>
  <button class="helpfab2" onclick="document.getElementById('emailSnippets').scrollIntoView({behavior:'smooth'});" title="Help via email">üìß Help</button>
<script>
  // api/ask-expert.js
import twilio from "twilio";

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ ok: false, error: "Method not allowed" });

  try {
    const { message, name } = req.body || {};
    const text = [message?.trim(), name ? `‚Äî from ${name}` : ""].filter(Boolean).join(" ");
    if (!text) return res.status(400).json({ ok: false, error: "Empty message" });

    const {
      TWILIO_ACCOUNT_SID,
      TWILIO_AUTH_TOKEN,
      TWILIO_WHATSAPP_FROM, // e.g., "whatsapp:+14155238886" (Twilio sandbox number)
      TWILIO_WHATSAPP_TO    // e.g., "whatsapp:+13175839106" (YOUR WhatsApp)
    } = process.env;

    if (!TWILIO_ACCOUNT_SID || !TWILIO_AUTH_TOKEN || !TWILIO_WHATSAPP_FROM || !TWILIO_WHATSAPP_TO) {
      return res.status(500).json({ ok: false, error: "Missing WhatsApp env vars" });
    }

    const client = twilio(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN);

    const msg = await client.messages.create({
      from: TWILIO_WHATSAPP_FROM,
      to: TWILIO_WHATSAPP_TO,
      body: `Ask-the-Expert: ${text}`
    });

    return res.status(200).json({ ok: true, sid: msg.sid });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ ok: false, error: e.message || "Send failed" });
  }
}

</script>
<script>
// --- Safety wiring to ensure buttons work ---
(function(){
  function safeScroll(sel){
    const el=document.querySelector(sel); if(el){ el.scrollIntoView({behavior:'smooth'}); }
  }
  const startBtn=document.getElementById('startGuideBtn');
  if(startBtn){ startBtn.addEventListener('click',()=>safeScroll('#steps')); }
  const glossBtn=document.getElementById('openGlossaryBtn');
  if(glossBtn){ glossBtn.addEventListener('click',()=>safeScroll('#glossary')); }

  // Email snippet buttons exist as <a href="mailto:‚Ä¶">; add gentle checks
  const mailLinks = document.querySelectorAll('#emailSnippets a[href^="mailto:"]');
  mailLinks.forEach(a=>{
    a.addEventListener('click',()=>{ try{ toast('Opening your email app‚Ä¶'); }catch(e){} });
  });
  const copyBtns = document.querySelectorAll('#emailSnippets button');
  copyBtns.forEach(b=> b.addEventListener('click',()=>{ try{ toast('Copied to clipboard'); }catch(e){} }));
})();
</script>
<script>
  // Add visual copied badge to email snippet copy buttons
  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('#emailSnippets button').forEach(btn=>{
      btn.addEventListener('click', ()=>{ try{ showCopied(btn); }catch(e){} });
    });
  });
</script>
<script>
  // Robust copy handlers for email snippets
  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('#emailSnippets button[data-copy]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const txt = btn.getAttribute('data-copy')||''; copyText(txt, btn);
      });
    });
  });
</script>
<!-- ‚úÖ Floating Help and Ask Expert Buttons -->
<button class="helpfab2" id="helpBtn" title="Highlight Email Snippets Section">
  üìß Help
</button>

<!-- Floating Ask-the-Expert button -->
<button class="askfab" onclick="openExpert()" title="Ask the expert">
  <span class="pulse"></span> Ask the Expert
</button>

<!-- Ask the Expert dialog (POSTs to /api/ask-expert) -->
<!-- Ask the Expert ‚Äî Live Chat (Twilio Conversations) -->
<dialog id="expert" style="border:none;border-radius:16px;max-width:760px;width:92%;padding:0">
  <form method="dialog" class="card" style="margin:0">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">Ask the Expert ‚Äî Live Chat</h3>
      <button class="btn" value="close">‚úñ Close</button>
    </div>

    <!-- Chat UI -->
    <div id="chatRoot" class="card" style="border-style:dashed;display:flex;flex-direction:column;gap:8px;height:520px">
      <div id="chatMessages"
           style="flex:1;overflow:auto;border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff"></div>

      <div class="row" style="gap:8px">
        <input id="chatInput"
               class="search"
               placeholder="Type your message‚Ä¶"
               style="flex:1"
               autocomplete="off" />
        <button id="chatSend" class="btn primary" type="button">Send</button>
      </div>

      <p class="inline-help" id="chatStatus" aria-live="polite">Connecting‚Ä¶</p>
    </div>

    <!-- (Optional) email fallback link -->
    <div class="row" style="justify-content:flex-end;margin-top:6px">
      <a class="btn" href="mailto:ktripurari@salud.unm.edu?subject=Ask%20the%20Expert%20%E2%80%94%20Question">‚úâÔ∏è Email instead</a>
    </div>
  </form>
</dialog>
<script>
  // ===== Twilio Conversations Live Chat wiring =====
  const CHAT = {
    client: null,
    conversation: null,
    inited: false,
    // Use the same unique name you set in env: CONVERSATION_UNIQUE_NAME
    uniqueName: 'site-support'
  };

  async function initChatOnce() {
    if (CHAT.inited) return;
    CHAT.inited = true;

    const statusEl = document.getElementById('chatStatus');
    const msgBox   = document.getElementById('chatMessages');
    const input    = document.getElementById('chatInput');
    const sendBtn  = document.getElementById('chatSend');

    function logStatus(t){ if(statusEl) statusEl.textContent = t; }

    try {
      logStatus('Requesting access token‚Ä¶');
      const tokRes = await fetch('/api/twilio-token');
      const { token, identity, error: tokErr } = await tokRes.json();
      if (!tokRes.ok || !token) throw new Error(tokErr || 'No token');

      // Create the Conversations client
      CHAT.client = await Twilio.Conversations.Client.create(token);

      CHAT.client.on('connectionStateChanged', (state) => {
        if (state === 'connected') logStatus('Connected. Loading conversation‚Ä¶');
        else if (state === 'connecting') logStatus('Connecting‚Ä¶');
        else if (state === 'disconnecting') logStatus('Disconnecting‚Ä¶');
        else if (state === 'disconnected') logStatus('Disconnected.');
      });

      // Ensure conversation exists and join
      const convRes = await fetch('/api/ensure-conversation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ uniqueName: CHAT.uniqueName })
      });
      const { conversationSid, error: convErr } = await convRes.json();
      if (!convRes.ok || !conversationSid) throw new Error(convErr || 'No conversation');

      // Get the conversation
      CHAT.conversation = await CHAT.client.getConversationBySid(conversationSid);

      // Join if not already
      try { await CHAT.conversation.join(); } catch (_) { /* already joined */ }

      // Render existing messages
      const paginator = await CHAT.conversation.getMessages();
      paginator.items.forEach(renderMessage);

      // Listen for new messages
      CHAT.conversation.on('messageAdded', renderMessage);

      // Send handler
      const sendNow = async () => {
        const body = (input.value || '').trim();
        if (!body) return;
        input.value = '';
        await CHAT.conversation.sendMessage(body);
        scrollToBottom();
      };
      sendBtn.addEventListener('click', sendNow);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendNow(); }});

      logStatus('You are chatting as ' + identity + '. Messages forward to our WhatsApp/inbox.');
      scrollToBottom();

      function renderMessage(m) {
        // very simple bubble UI
        const mine = m.author === identity;
        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.justifyContent = mine ? 'flex-end' : 'flex-start';
        row.style.margin = '6px 0';

        const bubble = document.createElement('div');
        bubble.textContent = m.body;
        bubble.style.maxWidth = '76%';
        bubble.style.padding  = '8px 12px';
        bubble.style.border = '1px solid var(--line)';
        bubble.style.borderRadius = '14px';
        bubble.style.background = mine ? 'var(--brand)' : 'var(--card)';
        bubble.style.color = mine ? '#fff' : 'var(--ink)';
        row.appendChild(bubble);

        msgBox.appendChild(row);
        scrollToBottom();
      }

      function scrollToBottom(){ msgBox.scrollTop = msgBox.scrollHeight; }

    } catch (err) {
      console.error(err);
      const statusEl = document.getElementById('chatStatus');
      if (statusEl) statusEl.textContent = '‚ùå Chat failed to load. Check API routes & env.';
    }
  }

  // Reuse your existing opener; just initialize the chat when opened
  function openExpert() {
    const dlg = document.getElementById('expert');
    if (dlg && typeof dlg.showModal === 'function') dlg.showModal();
    initChatOnce();
    const input = document.getElementById('chatInput');
    if (input) setTimeout(()=> input.focus(), 50);
  }
  // expose to global if needed elsewhere
  window.openExpert = openExpert;
</script>



<!-- ‚úÖ Script: Make Help Button Scroll & Glow -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const helpBtn = document.getElementById('helpBtn');
  const emailSection = document.getElementById('emailSnippets');

  if (helpBtn && emailSection) {
    helpBtn.addEventListener('click', () => {
      // Scroll smoothly
      emailSection.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Add glowing animation
      emailSection.classList.add('glow-highlight');

      // Remove glow after 3 seconds
      setTimeout(() => emailSection.classList.remove('glow-highlight'), 3000);
    });
  }
});
</script>

<!-- ‚úÖ CSS: Glowing Pulse Animation -->
<style>
  /* Floating buttons */
  .helpfab2 {
    position: fixed;
    right: 18px;
    bottom: 78px;
    z-index: 100;
    background: linear-gradient(135deg,#a855f7,#06b6d4);
    color: #fff;
    border: none;
    border-radius: 999px;
    padding: 12px 16px;
    box-shadow: 0 12px 28px rgba(0,0,0,.25);
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: transform 0.2s ease;
  }
  .helpfab2:hover {
    transform: translateY(-2px);
  }

  .askfab {
    position: fixed;
    right: 18px;
    bottom: 18px;
    z-index: 100;
    background: linear-gradient(135deg,#22c55e,#06b6d4);
    color: #fff;
    border: none;
    border-radius: 999px;
    padding: 14px 18px;
    box-shadow: 0 12px 28px rgba(0,0,0,.25);
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: transform 0.2s ease;
  }
  .askfab:hover {
    transform: translateY(-2px);
  }
  .askfab .pulse {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: #fff;
    box-shadow: 0 0 0 0 rgba(255,255,255,.6);
    animation: pulse 2s ease-out infinite;
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255,255,255,.6); }
    70% { box-shadow: 0 0 0 16px rgba(255,255,255,0); }
    100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
  }

  /* ‚ú® Email Snippets Glow Effect */
  @keyframes pulseGlow {
    0%   { box-shadow: 0 0 0px 0 rgba(34,197,94,0.0); border-color: transparent; }
    25%  { box-shadow: 0 0 15px 5px rgba(34,197,94,0.5); border-color: #22c55e; }
    50%  { box-shadow: 0 0 25px 8px rgba(34,197,94,0.7); border-color: #16a34a; }
    75%  { box-shadow: 0 0 15px 5px rgba(34,197,94,0.5); border-color: #22c55e; }
    100% { box-shadow: 0 0 0px 0 rgba(34,197,94,0.0); border-color: transparent; }
  }
  #emailSnippets.glow-highlight {
    animation: pulseGlow 2s ease-in-out 2;
    border: 4px solid #22c55e !important;
    border-radius: 16px;
    transition: border 0.3s ease;
  }
</style>
<script>
  // ----- Ask-the-Expert wiring (WhatsApp via /api/ask-expert) -----
  function openExpert() {
    const dlg = document.getElementById('expert');
    if (dlg && typeof dlg.showModal === 'function') dlg.showModal();
    const msg = document.getElementById('expertMsg');
    if (msg) msg.focus();
  }

  (function setupExpert(){
    const form   = document.getElementById('expertForm');
    const nameEl = document.getElementById('expertName');
    const msgEl  = document.getElementById('expertMsg');
    const send   = document.getElementById('expertSendBtn');
    const stat   = document.getElementById('expertStatus');
    const emailF = document.getElementById('expertEmailFallback');

    if (!form || !msgEl || !send) return;

    const enable = () => { send.disabled = !(msgEl.value.trim().length > 0); };
    msgEl.addEventListener('input', enable); enable();

    // Optional Email fallback
    if (emailF) {
      emailF.addEventListener('click', () => {
        const subj = 'Ask the Expert ‚Äî Question';
        const body = [msgEl.value.trim(), nameEl.value.trim() ? `‚Äî from ${nameEl.value.trim()}` : '']
          .filter(Boolean).join(' ');
        window.location.href = `mailto:ktripurari@salud.unm.edu?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body || 'Hello!')}`;
        try { toast('Opening your email app‚Ä¶'); } catch(_) {}
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = msgEl.value.trim();
      const name    = nameEl.value.trim();

      if (!message) return;

      send.disabled = true;
      stat.textContent = 'Sending‚Ä¶';
      try {
        const res = await fetch('/api/ask-expert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, name })
        });
        const data = await res.json();
        if (res.ok && data.ok) {
          stat.textContent = '‚úÖ Sent! Check WhatsApp (Twilio Sandbox chat).';
          try { toast('Message sent to WhatsApp'); } catch(_) {}
          // clear inputs after a short delay, then close dialog
          setTimeout(() => {
            msgEl.value = '';
            nameEl.value = '';
            enable();
            const dlg = document.getElementById('expert');
            if (dlg && typeof dlg.close === 'function') dlg.close();
          }, 600);
        } else {
          throw new Error(data?.error || 'Send failed');
        }
      } catch (err) {
        stat.textContent = '‚ùå Could not send. Make sure Sandbox is joined; try again.';
        try { toast('Send failed'); } catch(_) {}
      } finally {
        send.disabled = false;
      }
    });
  })();
</script>

</body>
</html>
